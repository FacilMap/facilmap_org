<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<!--
	This file is part of FacilMap.

	FacilMap is free software: you can redistribute it and/or modify
	it under the terms of the GNU Affero General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	FacilMap is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Affero General Public License for more details.

	You should have received a copy of the GNU Affero General Public License
	along with FacilMap.  If not, see <http://www.gnu.org/licenses/>.

	Obtain the source code from http://gitorious.org/facilmap.
-->
	<head>
		<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
		<title>FacilMap Beta</title>
		<meta name="description" content="FacilMap combines OpenStreetMap, Google and Yahoo maps into one simple map interface with useful tools and a search engine." />
		<script type="text/javascript"> // <![CDATA[
			if(location.search.length > 1 || location.host == "www.facilmap.org")
			{ // Move query string to location hash part, remove www. from hostname
				var hash = location.href.match(/#(.*)$/);
				hash = hash ? hash[1] : "";
				location.replace(location.protocol+"//"+(location.host == "www.facilmap.org" ? "facilmap.org" : location.host)+location.pathname+"#"+location.search.substr(1).replace("&", ";")+(location.search.length > 1 && hash.length > 0 ? ";" : "")+hash);
			}
		// ]]>
		</script>
		<style type="text/css">
			html,body { margin:0; padding:0; border-style:none; position:absolute; top:0; left:0; height:100%; width:100%; color:#000; background:#fff; }
			a { color:inherit; text-decoration:underline; }
			#map { position:absolute; top:0; left:0; height:100%; width:100%; }
			dl { margin:0; padding:0; }
			dt { margin:0; padding:0; font-weight:bold; float:left; clear:left; }
			dt:after { content:": "; }
			dd { margin:0; padding:0; }
			ul.buttons { list-style-type:none; padding:0; margin:0 }
			ul.buttons li { display:inline; margin:0; padding:0; }

			#search { position:absolute; top:1em; left:55px; border:.3em dotted #000; padding:1em 1.5em; background:#fff; z-index:100000; width:40em; }
			#search dt { display:none; }
			#search dl,#search ul { display:inline-block; vertical-align:top; }
			#search dl { width:25em; }
			#search dl input { width:100%; }
			#search ul { list-style-type:none; padding:0; margin:0; width:15em; }
			#search li { margin:0; padding:0; display:inline; }

			#search-toggle-routing { font-weight:bold; float:left; margin-right:1ex; }

			#search-results ol,#search-target-results ol { margin:0; padding:0; list-style-type:none; }
			#search-results li,#search-target-results li { display:block; margin:.3em 0; }
			#search-results a,#search-target-results a { font-weight:bold; }
			#search-results-toggle a { height:0; overflow:hidden; display:block; }

			#search #search-route-info { margin:.5em 0; }
			#search-route-info li { display:block; font-weight:bold; }

			#search-results-toggle a,#search-target-results { border-top:2px dotted; padding-top:.5em; margin-top:.5em; }

			#search-osm-cc { margin:0; padding:0; font-size:.8em; font-style:italic; }

			.marker-heading,.result-heading { margin:0 0 .5em 0; padding:0; font-size:1.2em; font-weight:bold; }
			.result-heading { font-weight:normal; }
			.result-heading a { font-size:.83em; }

			.olControlPanel { position:absolute; top:1em; right:5%; border:.2em dotted #000; padding:.3em; background:#fff; }

			.olControlItemActive,.olControlItemInactive,.olControlOpenStreetBugsItemActive,.olControlOpenStreetBugsItemInactive,.fmControlCreateMarkerItemActive,.fmControlCreateMarkerItemInactive { height:25px; width:25px; background-repeat:no-repeat; background-position:center; float:left; padding:0 .2em; }
			.olControlItemInactive,.olControlOpenStreetBugsItemInactive,.fmControlCreateMarkerItemInactive { opacity:0.3; -moz-opacity:0.3; filter:alpha(opacity=30); }

			.olControlItemActive,.olControlItemInactive { background-image:url("move.png"); }
			.olControlOpenStreetBugsItemActive,.olControlOpenStreetBugsItemInactive { background-image:url(http://openstreetbugs.schokokeks.org/client/icon_error_add.png); }
			.fmControlCreateMarkerItemActive,.fmControlCreateMarkerItemInactive { background-image:url(api/marker.png); }

			#map .olControlAttribution { bottom:1.5em; text-shadow:#fff 1px 1px 0; }
			#map .fmControlGeoLocation { position:absolute; font-size:smaller; right:3px; bottom:3em; text-shadow:#fff 1px 1px 0; }
			#map .olControlMousePosition { text-shadow:#fff 1px 1px 0; }

			fieldset.content-hidden { border-left:none; border-bottom:none; border-right:none; }
			fieldset.content-hidden legend a:before { content:"+ "; color:#aaa; }
			fieldset.content-visible legend a:before { content:"− "; color:#aaa; }
			fieldset.content-hidden .fieldset-content { display:none; }

			#pb { padding:20px; }
			#pb1 { height:20px; width:250px; border:1px solid #004; border-radius:10px; -moz-border-radius:10px; background-color:#ccf; position:relative; }
			#pb2 { position:absolute; top:-1px; bottom:-1px; right:-1px; left:10px; background-color:#fff; }
			#pb3 { height:20px; width:100%; border:1px solid #004; border-left:none; border-radius:0 10px 10px 0; -moz-border-radius:0 10px 10px 0; }
			#pb p { margin:5px 0 0 5px; padding:0; }
		</style>
		<link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="FacilMap Beta" />
	</head>
	<body>
		<div id="pb">
			<div id="pb1"><div id="pb2"><div id="pb3"></div></div></div>
			<p>Loading...</p>
		</div>
		<div id="map"></div>
		<script type="text/javascript">
		// <![CDATA[
			var pb = document.getElementById("pb2");
			var pbWidth = document.getElementById("pb1").offsetWidth-22;

			var pbProg = 0;
			var pbProgSet = 0;
			var pbTimeout = null;
			var pbOrigin = 0;

			function updateProgress()
			{
				var speed = Math.min(pbProgSet-pbOrigin, pbProg-pbProgSet)/2;
				if(speed < 0.01)
					speed = 0.01;
				pbProgSet += speed;
				if(pbProgSet > pbProg)
					pbProgSet = pbProg;
				pb.style.left = (10+Math.round(pbWidth*pbProgSet))+"px";
				if(pbProgSet < pbProg)
					pbTimeout = setTimeout(updateProgress, 100);
				else
					pbOrigin = pbProg;
			}

			// Copied from FacilMap API
			function makeAbsoluteURL(url) {
				// See http://stackoverflow.com/questions/470832/getting-an-absolute-url-from-a-relative-one-ie6-issue/472729#472729
				var el = document.createElement("div");
				el.innerHTML = "<a href=\"" + url.replace("&", "&amp;").replace("\"", "&quot;").replace("<", "&lt;").replace(">", "&gt;") + "\">x</a>";
				return el.firstChild.href;
			}

			function loadJavaScript(url, loadCheck, success) {
				var load = true;
				if(url == null || (loadCheck != null && loadCheck()))
					load = false;
				else
				{
					var scripts = document.getElementsByTagName("script");
					for(var i=0; i<scripts.length; i++)
					{
						if(makeAbsoluteURL(scripts[i].src) == makeAbsoluteURL(url))
						{
							load = false;
							break;
						}
					}
				}

				if(load)
				{
					var scriptTag = document.createElement("script");
					scriptTag.type = "text/javascript";
					scriptTag.src = url;
					document.getElementsByTagName("head")[0].appendChild(scriptTag);
				}

				if(loadCheck != null && success != null)
				{
					var callback = function(nextWait) {
						if(loadCheck())
							success();
						else
						{
							var newWait = nextWait*2;
							if(newWait > 10000)
								newWait = 10000;
							setTimeout(function(){ callback(newWait); }, nextWait);
						}
					};
					callback(10);
				}
			};

			var libs = {
				"OpenLayers" : {
					loaded : function() { return window.OpenLayers != undefined; },
					url : "OpenLayers-2.10/OpenLayers.js"
				},
				"FacilMap" : {
					loaded : function() { return window.FacilMap != undefined; },
					depends : [ "OpenLayers" ],
					url : "api/facilmap_src.js"
				},
				"osbLayer" : {
					loaded : function() { return window.OpenLayers != undefined && OpenLayers.Layer.OpenStreetBugs != undefined },
					depends : [ "OpenLayers" ],
					url : "http://api.facilmap.org/osblayer/osblayer.js"
				},
				"ajax-proxy" : {
					loaded : function() { return window.AjaxProxyXMLHttpRequest != undefined; },
					url : "http://api.facilmap.org/ajax-proxy/ajax-proxy.js"
				},
				"jQuery" : {
					loaded : function() { return window.jQuery != undefined; },
					url : "jquery-1.4.4.min.js"
				},
				"map.js" : {
					loaded : function() { return window.initMap != undefined; },
					depends : [ "OpenLayers", "FacilMap", "osbLayer", "ajax-proxy" ],
					url : "map.js"
				}
			};

			var load = function() {
				var loaded = 0;
				var number = 0;

				libsloop: for(var i in libs)
				{
					number++;
					if(libs[i].loaded())
						loaded++;

					if(libs[i].loading)
						continue;
					if(libs[i].depends != null)
					{
						for(var j=0; j<libs[i].depends.length; j++)
						{
							if(!libs[libs[i].depends[j]].loaded())
								continue libsloop;
						}
					}
					libs[i].loading = true;
					loadJavaScript(libs[i].url, libs[i].loaded, load);
				}

				pbProg = loaded/number;
				updateProgress();

				if(libs["map.js"].loaded())
				{
					initMap();
					$("#search-input").focus();
					$("#pb").css("display", "none");
					return;
				}
			};

			load();
		// ]]>
		</script>
		<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAApZR0PIISH23foUX8nxj4LxT9Os3n_HQD4ATZq_2B5J8ffa0H_RTkd5XAs6VL9qzpi_zJeEmkjzZajQ"></script>
		<script type="text/javascript" src="http://api.maps.yahoo.com/ajaxymap?v=3.0&amp;appid=facilmap"></script>
	</body>
</html>
